========================================
CHECKLIST COMPLETO DE DEPLOY PARA GOOGLE CLOUD
========================================

üìã PR√â-REQUISITOS
-----------------

1. Conta e Projeto Google Cloud
   [ ] Conta Google Cloud ativa
   [ ] Projeto criado no Google Cloud Console
   [ ] Billing habilitado no projeto
   [ ] APIs necess√°rias habilitadas:
       - Cloud Run API
       - Cloud SQL Admin API
       - Cloud Build API
       - Cloud Storage API (se usar Cloud Storage)

2. Banco de Dados Cloud SQL
   [ ] Inst√¢ncia PostgreSQL criada no Cloud SQL
   [ ] Banco de dados criado (sistema_rural ou outro nome)
   [ ] Usu√°rio do banco criado
   [ ] Senha do banco definida
   [ ] Connection name anotado (formato: PROJECT:REGION:INSTANCE)

3. Vari√°veis de Ambiente (Configurar no Cloud Run)
   
   OBRIGAT√ìRIAS:
   [ ] CLOUD_SQL_CONNECTION_NAME - Formato: PROJECT:REGION:INSTANCE
   [ ] DB_NAME - Nome do banco de dados (ex: sistema_rural)
   [ ] DB_USER - Usu√°rio do banco de dados (ex: monpec)
   [ ] DB_PASSWORD - Senha do banco de dados
   [ ] SECRET_KEY - Chave secreta do Django
   [ ] DJANGO_SETTINGS_MODULE - Definir como: sistema_rural.settings_gcp
   
   OPCIONAIS (mas recomendadas):
   [ ] GOOGLE_CLOUD_PROJECT - ID do projeto GCP
   [ ] DEBUG - False para produ√ß√£o
   [ ] USE_CLOUD_STORAGE - True se usar Cloud Storage
   [ ] GS_BUCKET_NAME - Nome do bucket se usar Cloud Storage
   [ ] REDIS_HOST - Host do Redis se usar cache Redis

üîß CONFIGURA√á√ÉO DO CLOUD RUN
-----------------------------

1. Criar Servi√ßo Cloud Run
   Comando:
   gcloud run deploy monpec \
     --source . \
     --platform managed \
     --region us-central1 \
     --allow-unauthenticated \
     --add-cloudsql-instances=PROJECT:REGION:INSTANCE \
     --set-env-vars="CLOUD_SQL_CONNECTION_NAME=PROJECT:REGION:INSTANCE,DB_NAME=sistema_rural,DB_USER=monpec,DB_PASSWORD=SUA_SENHA,SECRET_KEY=SUA_SECRET_KEY,DJANGO_SETTINGS_MODULE=sistema_rural.settings_gcp"

2. Configurar Permiss√µes
   [ ] Service account com permiss√£o para acessar Cloud SQL
   [ ] Service account com permiss√£o para acessar Cloud Storage (se usar)

3. Configurar Dom√≠nio Customizado (Opcional)
   [ ] Dom√≠nio configurado no Cloud Run
   [ ] DNS configurado apontando para o Cloud Run
   [ ] Certificado SSL configurado

üì¶ ARQUIVOS NECESS√ÅRIOS
-----------------------

Arquivos que DEVEM estar no reposit√≥rio:
   [x] Dockerfile - Criar manualmente (veja CRIAR_DOCKERFILE_INSTRUCOES.txt)
   [x] entrypoint.sh - J√° existe
   [x] requirements_producao.txt - J√° existe
   [x] sistema_rural/settings_gcp.py - J√° existe
   [ ] .dockerignore - Criar se necess√°rio
   [ ] .gcloudignore - Criar se necess√°rio

Arquivos que N√ÉO devem estar no reposit√≥rio:
   [ ] .env ou .env_producao (usar vari√°veis de ambiente do Cloud Run)
   [ ] __pycache__/ (adicionar ao .gitignore)
   [ ] *.pyc (adicionar ao .gitignore)
   [ ] venv/ ou env/ (adicionar ao .gitignore)

üöÄ PROCESSO DE DEPLOY
----------------------

Op√ß√£o 1: Deploy via Cloud Build (Recomendado)
   1. Fazer commit das mudan√ßas:
      git add .
      git commit -m "Preparar para deploy GCP"
      git push origin main

   2. Criar trigger do Cloud Build (se usar GitHub Actions)
      Ou executar build manualmente:
      gcloud builds submit --tag gcr.io/PROJECT_ID/monpec

Op√ß√£o 2: Deploy Direto via Cloud Run
   gcloud run deploy monpec \
     --source . \
     --platform managed \
     --region us-central1

‚úÖ VERIFICA√á√ïES P√ìS-DEPLOY
---------------------------

1. Verificar Logs
   Comando: gcloud run services logs read monpec --region us-central1
   
   Verificar se h√°:
   [ ] Conex√£o com banco de dados estabelecida
   [ ] Migra√ß√µes executadas com sucesso
   [ ] Arquivos est√°ticos coletados
   [ ] Servidor iniciado sem erros

2. Testar Aplica√ß√£o
   [ ] Acessar URL do Cloud Run
   [ ] Testar login
   [ ] Verificar se imagens/arquivos est√°ticos carregam
   [ ] Testar funcionalidades principais

3. Verificar Performance
   [ ] Tempo de resposta adequado
   [ ] Sem erros 500
   [ ] Conex√µes com banco funcionando

üêõ TROUBLESHOOTING
------------------

Erro: "CLOUD_SQL_CONNECTION_NAME n√£o definido"
   Solu√ß√£o: Verificar se a vari√°vel de ambiente est√° configurada no Cloud Run

Erro: "Connection refused" ao conectar no banco
   Solu√ß√£o: 
   - Verificar se o Cloud SQL instance est√° rodando
   - Verificar se o Cloud Run tem permiss√£o para acessar Cloud SQL
   - Verificar se o connection name est√° correto

Erro: "Static files not found"
   Solu√ß√£o:
   - Verificar se collectstatic foi executado
   - Verificar configura√ß√£o do WhiteNoise ou Cloud Storage
   - Verificar se STATIC_ROOT est√° correto

Erro: "Module not found"
   Solu√ß√£o:
   - Verificar se todas as depend√™ncias est√£o em requirements_producao.txt
   - Verificar se o build instalou todas as depend√™ncias

üìù NOTAS IMPORTANTES
--------------------

1. Banco de Dados: O Cloud Run se conecta ao Cloud SQL via Unix Socket quando 
   CLOUD_SQL_CONNECTION_NAME est√° definido. N√£o precisa de IP p√∫blico.

2. Arquivos Est√°ticos: Por padr√£o, usa WhiteNoise para servir arquivos est√°ticos. 
   Para melhor performance, considere usar Cloud Storage.

3. Migra√ß√µes: As migra√ß√µes s√£o executadas automaticamente no entrypoint.sh. 
   Se falharem, o container ainda inicia mas pode haver problemas.

4. Logs: Todos os logs v√£o para o Cloud Logging. Use gcloud run services logs read 
   para visualizar.

5. Timeout: O Cloud Run tem timeout padr√£o de 300 segundos. Se suas migra√ß√µes 
   demorarem mais, considere aumentar o timeout.

========================================







