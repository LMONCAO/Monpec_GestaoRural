{% extends "base_navegacao.html" %}

{% block title %}Projetos - Sistema Monpec{% endblock %}

{% block breadcrumbs %}
<li><a href="{% url 'dashboard' %}">Início</a></li>
<li class="breadcrumb-separator">›</li>
<li><a href="{% url 'propriedades_lista' propriedade.produtor_id %}">Propriedades</a></li>
<li class="breadcrumb-separator">›</li>
<li><a href="{% url 'propriedade_modulos' propriedade.id %}">{{ propriedade.nome }}</a></li>
<li class="breadcrumb-separator">›</li>
<li class="active">Projetos</li>
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <div class="d-flex justify-content-between align-items-start">
        <div>
            <h1 class="page-title">Gestão de Projetos</h1>
            <p class="page-subtitle">{{ propriedade.nome }} - Planejamento e acompanhamento de investimentos</p>
        </div>
        <div class="d-flex gap-2">
            <a href="{% url 'propriedade_modulos' propriedade.id %}" class="btn-outline">Voltar</a>
            <a href="#" class="btn-navy">Novo Projeto</a>
        </div>
    </div>
</div>

<!-- Estatísticas de Projetos -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card-clean text-center">
            <div class="card-valor-destaque" style="font-size: 2rem;">{{ total_projetos|default:"0" }}</div>
            <div style="font-size: 12px; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.05em;">
                Total de Projetos
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card-clean text-center">
            <div class="card-valor-destaque" style="font-size: 2rem;">{{ em_andamento|default:"0" }}</div>
            <div style="font-size: 12px; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.05em;">
                Em Andamento
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card-clean text-center">
            <div class="card-valor-destaque">R$ {{ orcamento_total|default:"0,00" }}</div>
            <div style="font-size: 12px; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.05em;">
                Orçamento Total
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card-clean text-center">
            <div class="card-valor-destaque">R$ {{ realizado|default:"0,00" }}</div>
            <div style="font-size: 12px; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.05em;">
                Custo Realizado
            </div>
        </div>
    </div>
</div>

<!-- Projetos por Status -->
<h2 style="font-family: 'Playfair Display', serif; font-size: 1.75rem; color: var(--navy); margin-bottom: 1.5rem;">
    Projetos Ativos
</h2>

{% if projetos %}
<div class="cards-grid">
    {% for projeto in projetos %}
    <div class="card-clean">
        <div class="d-flex justify-content-between align-items-start mb-3">
            <h3 class="card-title" style="margin-bottom: 0;">{{ projeto.nome }}</h3>
            <span class="badge-destaque">{{ projeto.get_status_display }}</span>
        </div>
        
        <p style="color: var(--text-light); font-size: 14px; margin-bottom: 1rem;">
            {{ projeto.descricao|truncatewords:15 }}
        </p>
        
        <div class="mb-3">
            <div style="font-size: 12px; color: var(--text-light); margin-bottom: 0.5rem;">
                Orçamento: <strong>R$ {{ projeto.orcamento_previsto }}</strong>
            </div>
            <div style="font-size: 12px; color: var(--text-light); margin-bottom: 0.5rem;">
                Realizado: <strong class="destaque-valor">R$ {{ projeto.custo_realizado }}</strong>
            </div>
            <div style="font-size: 12px; color: var(--text-light);">
                Conclusão: <strong>{{ projeto.data_conclusao_prevista|date:"d/m/Y" }}</strong>
            </div>
        </div>
        
        <!-- Barra de Progresso -->
        <div style="background: var(--gray-bg); border-radius: 8px; height: 8px; overflow: hidden; margin-bottom: 0.5rem;">
            <div style="background: var(--sage-green); height: 100%; width: {{ projeto.percentual_gasto }}%;"></div>
        </div>
        <div style="font-size: 12px; color: var(--text-light); text-align: right;">
            {{ projeto.percentual_gasto|default:"0" }}% do orçamento
        </div>
        
        <div class="d-flex gap-2 mt-3">
            <a href="#" class="btn-outline flex-fill text-center" style="padding: 0.5rem;">Ver Detalhes</a>
            <a href="#" class="btn-outline flex-fill text-center" style="padding: 0.5rem;">Editar</a>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card-empty">
    <h3 style="color: var(--text-light); font-weight: 400; margin-bottom: 1rem;">
        Nenhum projeto cadastrado
    </h3>
    <p style="color: var(--text-light); margin-bottom: 2rem;">
        Comece planejando seus investimentos e melhorias
    </p>
    <a href="#" class="btn-navy">Criar Primeiro Projeto</a>
</div>
{% endif %}
{% endblock %}

