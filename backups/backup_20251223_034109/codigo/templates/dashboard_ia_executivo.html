{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard Executivo IA - Sistema Monpec{% endblock %}

{% block extra_css %}
<style>
    .dashboard-card {
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        transition: transform 0.3s, box-shadow 0.3s;
        height: 100%;
    }
    
    .dashboard-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 12px rgba(0,0,0,0.15);
    }
    
    .kpi-card {
        text-align: center;
        padding: 20px;
    }
    
    .kpi-value {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 10px 0;
    }
    
    .kpi-label {
        color: #6c757d;
        font-size: 0.9rem;
        text-transform: uppercase;
    }
    
    .kpi-trend {
        font-size: 1.1rem;
        margin-top: 10px;
    }
    
    .trend-up {
        color: #28a745;
    }
    
    .trend-down {
        color: #dc3545;
    }
    
    .chart-container {
        position: relative;
        height: 350px;
        margin: 20px 0;
    }
    
    .alert-custom {
        border-left: 4px solid;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .alert-critical {
        border-left-color: #dc3545;
        background-color: #f8d7da;
    }
    
    .alert-warning {
        border-left-color: #ffc107;
        background-color: #fff3cd;
    }
    
    .alert-success {
        border-left-color: #28a745;
        background-color: #d4edda;
    }
    
    .opportunity-card {
        border-left: 4px solid #17a2b8;
        padding: 15px;
        margin-bottom: 10px;
        background: #f8f9fa;
        border-radius: 5px;
    }
    
    .score-badge {
        font-size: 1.8rem;
        font-weight: bold;
        padding: 10px 20px;
        border-radius: 50px;
        display: inline-block;
    }
    
    .score-excellent {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .score-good {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
    }
    
    .score-regular {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        color: #333;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Cabeçalho -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-4">
                <i class="fas fa-robot text-primary"></i> 
                Dashboard Executivo IA
            </h1>
            <p class="lead text-muted">Análises inteligentes e insights automáticos do seu rebanho</p>
        </div>
    </div>
    
    <!-- KPIs Principais -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card dashboard-card bg-gradient-primary text-white">
                <div class="card-body kpi-card">
                    <div class="kpi-label">Total de Animais</div>
                    <div class="kpi-value" id="kpi-total-animais">{{ total_animais|default:0 }}</div>
                    <div class="kpi-trend trend-up">
                        <i class="fas fa-arrow-up"></i> {{ crescimento_mes|default:"+5.2%" }}
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card dashboard-card bg-gradient-success text-white">
                <div class="card-body kpi-card">
                    <div class="kpi-label">Receita Mensal</div>
                    <div class="kpi-value" id="kpi-receita">R$ {{ receita_mensal|default:"0"|floatformat:0 }}</div>
                    <div class="kpi-trend trend-up">
                        <i class="fas fa-arrow-up"></i> {{ variacao_receita|default:"+12.3%" }}
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card dashboard-card bg-gradient-info text-white">
                <div class="card-body kpi-card">
                    <div class="kpi-label">Margem de Lucro</div>
                    <div class="kpi-value" id="kpi-margem">{{ margem_lucro|default:"23.5" }}%</div>
                    <div class="kpi-trend trend-up">
                        <i class="fas fa-check-circle"></i> Excelente
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card dashboard-card bg-gradient-warning text-white">
                <div class="card-body kpi-card">
                    <div class="kpi-label">Score IA</div>
                    <div class="kpi-value" id="kpi-score-ia">{{ score_ia|default:85 }}/100</div>
                    <div class="kpi-trend">
                        <i class="fas fa-star"></i> Bom Desempenho
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Gráficos Principais -->
    <div class="row mb-4">
        <!-- Evolução do Rebanho -->
        <div class="col-lg-8 mb-3">
            <div class="card dashboard-card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-area"></i> Evolução do Rebanho (12 meses)</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="chartEvolucaoRebanho"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Distribuição por Categoria -->
        <div class="col-lg-4 mb-3">
            <div class="card dashboard-card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-pie"></i> Distribuição</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="chartDistribuicao"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Receitas vs Despesas -->
    <div class="row mb-4">
        <div class="col-lg-6 mb-3">
            <div class="card dashboard-card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Receitas vs Despesas</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="chartReceitasDespesas"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Margem de Lucro -->
        <div class="col-lg-6 mb-3">
            <div class="card dashboard-card">
                <div class="card-header bg-warning text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-line"></i> Margem de Lucro Mensal</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="chartMargemLucro"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Alertas e Oportunidades -->
    <div class="row mb-4">
        <div class="col-lg-6 mb-3">
            <div class="card dashboard-card">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0"><i class="fas fa-exclamation-triangle"></i> Alertas IA</h5>
                </div>
                <div class="card-body">
                    <div class="alert-custom alert-critical">
                        <strong><i class="fas fa-fire"></i> Superlotação:</strong> Fazenda Santa Rita está 15% acima da capacidade
                    </div>
                    <div class="alert-custom alert-warning">
                        <strong><i class="fas fa-baby"></i> Natalidade:</strong> Taxa atual (72%) está 8% abaixo do benchmark regional
                    </div>
                    <div class="alert-custom alert-success">
                        <strong><i class="fas fa-check"></i> Desfrute:</strong> Meta de 22% atingida este mês!
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 mb-3">
            <div class="card dashboard-card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-lightbulb"></i> Oportunidades IA</h5>
                </div>
                <div class="card-body">
                    <div class="opportunity-card">
                        <h6><i class="fas fa-shopping-cart"></i> Compra Recomendada</h6>
                        <p class="mb-1"><strong>50 Garrotes</strong> - Preço 12% abaixo da média</p>
                        <p class="mb-0 text-muted small">ROI estimado: 18% | Payback: 7 meses</p>
                    </div>
                    <div class="opportunity-card">
                        <h6><i class="fas fa-hand-holding-usd"></i> Venda Sugerida</h6>
                        <p class="mb-1"><strong>30 Bois Magros</strong> - Ponto ideal atingido</p>
                        <p class="mb-0 text-muted small">Receita estimada: R$ 135.000 | Margem: 22%</p>
                    </div>
                    <div class="opportunity-card">
                        <h6><i class="fas fa-exchange-alt"></i> Transferência</h6>
                        <p class="mb-1"><strong>20 Novilhas</strong> Santa Rita → São José</p>
                        <p class="mb-0 text-muted small">Economia: R$ 12.000/ano | ROI: 65%</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Score de Desempenho -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card dashboard-card">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0"><i class="fas fa-trophy"></i> Score de Desempenho vs Mercado</h5>
                </div>
                <div class="card-body text-center">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="kpi-label">Score Geral</div>
                            <div class="mt-3">
                                <span class="score-badge score-excellent">85/100</span>
                            </div>
                            <div class="mt-2 text-muted">EXCELENTE</div>
                        </div>
                        <div class="col-md-9">
                            <div class="chart-container" style="height: 200px;">
                                <canvas id="chartBenchmark"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script>
// Configuração global dos gráficos
Chart.defaults.font.family = "'Segoe UI', Arial, sans-serif";
Chart.defaults.color = '#495057';

// Cores modernas
const colors = {
    primary: '#667eea',
    success: '#28a745',
    danger: '#dc3545',
    warning: '#ffc107',
    info: '#17a2b8',
    purple: '#764ba2',
    orange: '#f5576c'
};

// 1. Gráfico de Evolução do Rebanho
const ctxEvolucao = document.getElementById('chartEvolucaoRebanho').getContext('2d');
const chartEvolucao = new Chart(ctxEvolucao, {
    type: 'line',
    data: {
        labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
        datasets: [{
            label: 'Total de Animais',
            data: [1200, 1235, 1180, 1210, 1245, 1280, 1315, 1290, 1325, 1360, 1395, 1430],
            borderColor: colors.primary,
            backgroundColor: 'rgba(102, 126, 234, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4
        }, {
            label: 'Meta IA',
            data: [1200, 1220, 1240, 1260, 1280, 1300, 1320, 1340, 1360, 1380, 1400, 1420],
            borderColor: colors.success,
            borderWidth: 2,
            borderDash: [5, 5],
            fill: false,
            pointRadius: 0
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'top',
            },
            tooltip: {
                mode: 'index',
                intersect: false,
            }
        },
        scales: {
            y: {
                beginAtZero: false,
                ticks: {
                    callback: function(value) {
                        return value.toLocaleString('pt-BR');
                    }
                }
            }
        }
    }
});

// 2. Gráfico de Distribuição por Categoria
const ctxDistribuicao = document.getElementById('chartDistribuicao').getContext('2d');
const chartDistribuicao = new Chart(ctxDistribuicao, {
    type: 'doughnut',
    data: {
        labels: ['Multíparas', 'Bezerros', 'Garrotes', 'Novilhas', 'Bois'],
        datasets: [{
            data: [350, 420, 280, 220, 160],
            backgroundColor: [
                colors.primary,
                colors.success,
                colors.warning,
                colors.info,
                colors.orange
            ],
            borderWidth: 0
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom'
            },
            tooltip: {
                callbacks: {
                    label: function(context) {
                        const label = context.label || '';
                        const value = context.parsed;
                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                        const percentage = ((value / total) * 100).toFixed(1);
                        return `${label}: ${value} animais (${percentage}%)`;
                    }
                }
            }
        }
    }
});

// 3. Gráfico Receitas vs Despesas
const ctxReceitas = document.getElementById('chartReceitasDespesas').getContext('2d');
const chartReceitas = new Chart(ctxReceitas, {
    type: 'bar',
    data: {
        labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
        datasets: [{
            label: 'Receitas',
            data: [85000, 92000, 78000, 88000, 95000, 102000, 98000, 105000, 110000, 108000, 115000, 120000],
            backgroundColor: colors.success,
            borderRadius: 5
        }, {
            label: 'Despesas',
            data: [65000, 70000, 60000, 68000, 72000, 78000, 75000, 80000, 84000, 82000, 88000, 92000],
            backgroundColor: colors.danger,
            borderRadius: 5
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'top',
            },
            tooltip: {
                callbacks: {
                    label: function(context) {
                        const label = context.dataset.label || '';
                        const value = context.parsed.y;
                        return `${label}: R$ ${value.toLocaleString('pt-BR')}`;
                    }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    callback: function(value) {
                        return 'R$ ' + (value/1000) + 'k';
                    }
                }
            }
        }
    }
});

// 4. Gráfico de Margem de Lucro
const ctxMargem = document.getElementById('chartMargemLucro').getContext('2d');
const chartMargem = new Chart(ctxMargem, {
    type: 'line',
    data: {
        labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
        datasets: [{
            label: 'Margem de Lucro (%)',
            data: [23.5, 23.9, 23.1, 22.7, 24.2, 23.5, 23.4, 23.8, 23.6, 24.1, 23.5, 23.3],
            borderColor: colors.warning,
            backgroundColor: 'rgba(255, 193, 7, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4
        }, {
            label: 'Meta (20%)',
            data: Array(12).fill(20),
            borderColor: colors.danger,
            borderWidth: 2,
            borderDash: [10, 5],
            fill: false,
            pointRadius: 0
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'top',
            }
        },
        scales: {
            y: {
                min: 15,
                max: 30,
                ticks: {
                    callback: function(value) {
                        return value + '%';
                    }
                }
            }
        }
    }
});

// 5. Gráfico de Benchmark (Radar)
const ctxBenchmark = document.getElementById('chartBenchmark').getContext('2d');
const chartBenchmark = new Chart(ctxBenchmark, {
    type: 'radar',
    data: {
        labels: ['Natalidade', 'Desfrute', 'GMD', 'Margem', 'Produtividade'],
        datasets: [{
            label: 'Sua Fazenda',
            data: [85, 92, 88, 90, 87],
            borderColor: colors.primary,
            backgroundColor: 'rgba(102, 126, 234, 0.2)',
            borderWidth: 2
        }, {
            label: 'Benchmark Mercado',
            data: [80, 80, 80, 80, 80],
            borderColor: colors.success,
            backgroundColor: 'rgba(40, 167, 69, 0.1)',
            borderWidth: 2,
            borderDash: [5, 5]
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            r: {
                min: 0,
                max: 100,
                ticks: {
                    stepSize: 20
                }
            }
        },
        plugins: {
            legend: {
                position: 'top'
            }
        }
    }
});

// Atualização automática a cada 30 segundos
setInterval(function() {
    // Aqui você pode fazer uma requisição AJAX para atualizar os dados
    // fetch('/api/dashboard/dados/').then(...)
}, 30000);
</script>
{% endblock %}

