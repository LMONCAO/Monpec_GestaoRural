{% extends 'gestao_rural/submenu_page_base.html' %}

{% block title %}Amortização - {{ propriedade.nome_propriedade }}{% endblock %}

{% with module_name='Dívidas Financeiras' module_icon='bi-credit-card' module_dashboard_url='dividas_dashboard' page_icon='bi-calculator' page_title='Amortização' %}
{% endwith %}

{% block page_description %}
Simule e gere a tabela de amortização dos contratos (PRICE ou SAC).
{% endblock %}

{% block page_content %}
<div class="content-card mb-3">
    <div class="content-card-header"><strong>Simulador</strong></div>
    <div class="content-card-body">
        <form method="post" class="row g-3 align-items-end">
            {% csrf_token %}
            <div class="col-md-4">
                <label class="form-label">Contrato</label>
                <select name="contrato_id" class="form-select" required>
                    <option value="">Selecione</option>
                    {% for c in contratos %}
                    <option value="{{ c.id }}">{{ c.banco }} - {{ c.numero_contrato|default:c.id }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">Método</label>
                <select name="metodo" class="form-select" required>
                    <option value="PRICE">PRICE</option>
                    <option value="SAC">SAC</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">Parcelas</label>
                <input type="number" name="parcelas" class="form-control" min="1" max="480" value="120" required />
            </div>
            <div class="col-md-2">
                <label class="form-label">Juros a.m. (%)</label>
                <input type="number" step="0.0001" min="0" name="juros_am" class="form-control" value="1.2" required />
            </div>
            <div class="col-md-2">
                <label class="form-label">1º Vencimento</label>
                <input type="date" name="primeiro_vencimento" class="form-control" required />
            </div>
            <div class="col-12">
                <button type="submit" name="simular" class="btn btn-primary"><i class="bi bi-calculator"></i> Simular e Gerar</button>
            </div>
        </form>
    </div>
    </div>

<div class="content-card">
    <div class="content-card-header"><strong>Tabela de Amortização</strong></div>
    <div class="content-card-body">
        {% if amortizacoes %}
        <div class="table-responsive">
            <table class="table table-sm align-middle">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Vencimento</th>
                        <th>Principal</th>
                        <th>Juros</th>
                        <th>Prestação</th>
                        <th>Saldo</th>
                    </tr>
                </thead>
                <tbody>
                    {% for a in amortizacoes %}
                    <tr>
                        <td>{{ a.numero_parcela }}</td>
                        <td>{{ a.data_vencimento|date:'d/m/Y' }}</td>
                        <td>R$ {{ a.valor_principal|floatformat:2 }}</td>
                        <td>R$ {{ a.valor_juros|floatformat:2 }}</td>
                        <td>R$ {{ a.valor_total|floatformat:2 }}</td>
                        <td>R$ {{ a.saldo_devedor|floatformat:2 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <i class="bi bi-inbox empty-state-icon"></i>
            <h3 class="empty-state-title">Nenhuma amortização gerada</h3>
            <p class="empty-state-description">Selecione um contrato e gere a tabela acima.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}


