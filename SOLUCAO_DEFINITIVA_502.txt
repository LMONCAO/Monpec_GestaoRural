# === SOLUÇÃO DEFINITIVA PARA ERRO 502 ===
# Executar linha por linha no Console Web da Locaweb

# 1. PARAR TUDO
pkill -9 python
sleep 3

# 2. IR PARA O DIRETÓRIO
cd /var/www/monpec.com.br

# 3. FAZER BACKUP
cp gestao_rural/urls.py gestao_rural/urls.py.backup.$(date +%H%M%S)

# 4. RECRIAR urls.py COMPLETAMENTE LIMPO
cat > gestao_rural/urls.py << 'EOF'
from django.urls import path
from . import views

app_name = 'gestao_rural'

urlpatterns = [
    path('', views.dashboard, name='dashboard'),
    path('propriedades/', views.propriedades_lista, name='propriedades_lista'),
    path('propriedade/<int:propriedade_id>/modulos/', views.propriedade_modulos, name='propriedade_modulos'),
    path('propriedade/<int:propriedade_id>/pecuaria/', views.pecuaria_dashboard, name='pecuaria_dashboard'),
    path('propriedade/<int:propriedade_id>/financeiro/', views.financeiro_dashboard, name='financeiro_dashboard'),
    path('categorias/', views.categorias_lista, name='categorias_lista'),
    path('logout/', views.logout_view, name='logout'),
]
EOF

# 5. VERIFICAR SE ESTÁ CORRETO
echo "=== Verificando urls.py ==="
cat gestao_rural/urls.py

# 6. TESTAR SINTAXE
python manage.py check

# 7. SE DEU TUDO CERTO, INICIAR DJANGO
source venv/bin/activate
nohup python manage.py runserver 127.0.0.1:8000 > /tmp/django.log 2>&1 &

# 8. VERIFICAR SE ESTÁ RODANDO
sleep 3
ps aux | grep python | grep runserver

echo "=== TESTE FINAL ==="
curl -I http://127.0.0.1:8000/

echo "=== FIM DA SOLUÇÃO ==="
