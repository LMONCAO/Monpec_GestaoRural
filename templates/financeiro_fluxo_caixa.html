{% extends "base_moderno.html" %}
{% load static %}

{% block title %}Fluxo de Caixa - Sistema Monpec{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/identidade_visual.css' %}">
<style>
    .page-title {
        background: linear-gradient(135deg, #6495ed 0%, #8cb5ff 100%);
        color: white;
        padding: 30px;
        border-radius: var(--border-radius-lg);
        margin-bottom: 30px;
        box-shadow: var(--shadow-md);
    }
    
    .flow-item {
        background: white;
        border-radius: var(--border-radius);
        padding: 20px;
        margin-bottom: 15px;
        border-left: 4px solid;
        box-shadow: var(--shadow-sm);
        transition: var(--transition);
    }
    
    .flow-item:hover {
        transform: translateX(5px);
        box-shadow: var(--shadow-md);
    }
    
    .flow-item.entrada { border-left-color: #2d7a4f; }
    .flow-item.saida { border-left-color: #c53030; }
    
    .flow-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .flow-category {
        font-weight: 600;
        color: #6495ed;
        font-size: 16px;
    }
    
    .flow-value {
        font-size: 20px;
        font-weight: 700;
    }
    
    .flow-value.entrada { color: #2d7a4f; }
    .flow-value.saida { color: #c53030; }
    
    .balance-card {
        background: linear-gradient(135deg, #8b6f47 0%, #a88b61 100%);
        color: white;
        border-radius: var(--border-radius-lg);
        padding: 30px;
        text-align: center;
        box-shadow: var(--shadow-lg);
    }
    
    .balance-value {
        font-size: 3rem;
        font-weight: 700;
        margin: 15px 0;
    }
    
    .waterfall-chart {
        background: white;
        border-radius: var(--border-radius-lg);
        padding: 30px;
        box-shadow: var(--shadow-md);
        margin-top: 30px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Título -->
    <div class="page-title">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h2 class="mb-2"><i class="fas fa-money-bill-wave"></i> Fluxo de Caixa</h2>
                <p class="mb-0">Controle completo de entradas e saídas</p>
            </div>
            <div>
                <button class="btn btn-light" onclick="exportarFluxoCaixa()">
                    <i class="fas fa-file-excel"></i> Exportar Excel
                </button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="row">
            <!-- Entradas -->
            <div class="col-lg-5">
                <h4 class="text-azul-marinho mb-3">
                    <i class="fas fa-arrow-down text-success"></i> Entradas
                </h4>
                
                <div class="flow-item entrada">
                    <div class="flow-header">
                        <span class="flow-category">
                            <i class="fas fa-hand-holding-usd"></i> Venda de Animais
                        </span>
                        <span class="flow-value entrada">R$ 125.000</span>
                    </div>
                    <small class="text-muted">93.9% das entradas</small>
                </div>
                
                <div class="flow-item entrada">
                    <div class="flow-header">
                        <span class="flow-category">
                            <i class="fas fa-seedling"></i> Arrendamento de Pastos
                        </span>
                        <span class="flow-value entrada">R$ 5.000</span>
                    </div>
                    <small class="text-muted">3.8% das entradas</small>
                </div>
                
                <div class="flow-item entrada">
                    <div class="flow-header">
                        <span class="flow-category">
                            <i class="fas fa-tools"></i> Prestação de Serviços
                        </span>
                        <span class="flow-value entrada">R$ 2.000</span>
                    </div>
                    <small class="text-muted">1.5% das entradas</small>
                </div>
                
                <div class="flow-item entrada">
                    <div class="flow-header">
                        <span class="flow-category">
                            <i class="fas fa-ellipsis-h"></i> Outras Receitas
                        </span>
                        <span class="flow-value entrada">R$ 1.000</span>
                    </div>
                    <small class="text-muted">0.8% das entradas</small>
                </div>
                
                <div class="card card-monpec mt-3">
                    <div class="card-body text-center" style="background: linear-gradient(135deg, rgba(45, 122, 79, 0.1) 0%, rgba(56, 161, 105, 0.1) 100%);">
                        <div class="kpi-label">Total de Entradas</div>
                        <div class="kpi-value text-success">R$ 133.000</div>
                    </div>
                </div>
            </div>
            
            <!-- Saídas -->
            <div class="col-lg-5">
                <h4 class="text-azul-marinho mb-3">
                    <i class="fas fa-arrow-up text-danger"></i> Saídas
                </h4>
                
                <div class="flow-item saida">
                    <div class="flow-header">
                        <span class="flow-category">
                            <i class="fas fa-shopping-cart"></i> Compra de Animais
                        </span>
                        <span class="flow-value saida">R$ 45.000</span>
                    </div>
                    <small class="text-muted">40.0% das saídas</small>
                </div>
                
                <div class="flow-item saida">
                    <div class="flow-header">
                        <span class="flow-category">
                            <i class="fas fa-apple-alt"></i> Ração e Suplementos
                        </span>
                        <span class="flow-value saida">R$ 28.000</span>
                    </div>
                    <small class="text-muted">24.9% das saídas</small>
                </div>
                
                <div class="flow-item saida">
                    <div class="flow-header">
                        <span class="flow-category">
                            <i class="fas fa-users"></i> Salários e Encargos
                        </span>
                        <span class="flow-value saida">R$ 15.000</span>
                    </div>
                    <small class="text-muted">13.3% das saídas</small>
                </div>
                
                <div class="flow-item saida">
                    <div class="flow-header">
                        <span class="flow-category">
                            <i class="fas fa-syringe"></i> Medicamentos e Vacinas
                        </span>
                        <span class="flow-value saida">R$ 8.500</span>
                    </div>
                    <small class="text-muted">7.6% das saídas</small>
                </div>
                
                <div class="flow-item saida">
                    <div class="flow-header">
                        <span class="flow-category">
                            <i class="fas fa-ellipsis-h"></i> Outros Custos
                        </span>
                        <span class="flow-value saida">R$ 16.500</span>
                    </div>
                    <small class="text-muted">14.7% das saídas</small>
                </div>
                
                <div class="card card-monpec mt-3">
                    <div class="card-body text-center" style="background: linear-gradient(135deg, rgba(197, 48, 48, 0.1) 0%, rgba(229, 62, 62, 0.1) 100%);">
                        <div class="kpi-label">Total de Saídas</div>
                        <div class="kpi-value text-danger">R$ 113.000</div>
                    </div>
                </div>
            </div>
            
            <!-- Saldo -->
            <div class="col-lg-2">
                <div class="balance-card">
                    <div class="kpi-label text-white">Saldo do Período</div>
                    <div class="balance-value">R$ 20k</div>
                    <div class="mt-3">
                        <i class="fas fa-check-circle" style="font-size: 24px;"></i>
                        <div class="mt-2">Positivo</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Gráfico Waterfall -->
        <div class="waterfall-chart">
            <h5 class="text-azul-marinho mb-4">
                <i class="fas fa-chart-bar"></i> Composição do Fluxo de Caixa
            </h5>
            <canvas id="chartWaterfall" height="80"></canvas>
        </div>
        
        <!-- Projeção Futura -->
        <div class="card card-monpec mt-4">
            <div class="card-monpec-header">
                <h5 class="mb-0"><i class="fas fa-crystal-ball"></i> Projeção dos Próximos 6 Meses</h5>
            </div>
            <div class="card-body">
                <canvas id="chartProjecao" height="80"></canvas>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
    // Gráfico Waterfall
    const ctxWaterfall = document.getElementById('chartWaterfall').getContext('2d');
    new Chart(ctxWaterfall, {
        type: 'bar',
        data: {
            labels: ['Vendas', 'Arrendamento', 'Serviços', 'Compras', 'Ração', 'Salários', 'Outros', 'SALDO'],
            datasets: [{
                label: 'Valor (R$)',
                data: [125000, 5000, 2000, -45000, -28000, -15000, -24000, 20000],
                backgroundColor: function(context) {
                    const value = context.parsed.y;
                    if (context.dataIndex === 7) return '#8b6f47'; // Saldo
                    return value > 0 ? '#2d7a4f' : '#c53030';
                },
                borderRadius: 8
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    ticks: {
                        callback: value => 'R$ ' + (value/1000) + 'k'
                    }
                }
            }
        }
    });
    
    // Gráfico de Projeção
    const ctxProjecao = document.getElementById('chartProjecao').getContext('2d');
    new Chart(ctxProjecao, {
        type: 'line',
        data: {
            labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
            datasets: [{
                label: 'Saldo Projetado',
                data: [20000, 42000, 65000, 85000, 108000, 130000],
                borderColor: '#6495ed',
                backgroundColor: 'rgba(30, 58, 95, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' }
            },
            scales: {
                y: {
                    ticks: {
                        callback: value => 'R$ ' + (value/1000) + 'k'
                    }
                }
            }
        }
    });
    
    function exportarFluxoCaixa() {
        window.location.href = '/api/relatorios/fluxo-caixa/excel/';
    }
</script>
{% endblock %}

