{% extends "base_navegacao.html" %}

{% block title %}Financeiro - Sistema Monpec{% endblock %}

{% block breadcrumbs %}
<li><a href="{% url 'dashboard' %}">Início</a></li>
<li class="breadcrumb-separator">›</li>
<li><a href="{% url 'propriedades_lista' propriedade.produtor_id %}">Propriedades</a></li>
<li class="breadcrumb-separator">›</li>
<li><a href="{% url 'propriedade_modulos' propriedade.id %}">{{ propriedade.nome }}</a></li>
<li class="breadcrumb-separator">›</li>
<li class="active">Financeiro</li>
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <div class="d-flex justify-content-between align-items-start">
        <div>
            <h1 class="page-title">Gestão Financeira</h1>
            <p class="page-subtitle">{{ propriedade.nome }} - Controle completo de receitas e despesas</p>
        </div>
        <div class="d-flex gap-2">
            <a href="{% url 'propriedade_modulos' propriedade.id %}" class="btn-outline">Voltar</a>
            <button type="button" class="btn-navy" onclick="mostrarFormularioFinanceiro()">Novo Lançamento</button>
        </div>
    </div>
</div>

<!-- Resumo Financeiro -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card-clean text-center">
            <div class="card-valor-destaque" style="color: #28a745;">R$ {{ total_receitas|default:"0,00" }}</div>
            <div style="font-size: 12px; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.05em;">
                Total de Receitas
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card-clean text-center">
            <div class="card-valor-destaque" style="color: #dc3545;">R$ {{ total_despesas|default:"0,00" }}</div>
            <div style="font-size: 12px; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.05em;">
                Total de Despesas
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card-clean text-center">
            <div class="card-valor-destaque">R$ {{ saldo|default:"0,00" }}</div>
            <div style="font-size: 12px; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.05em;">
                Saldo
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card-clean text-center">
            <div class="card-valor-destaque">{{ margem|default:"0" }}%</div>
            <div style="font-size: 12px; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.05em;">
                Margem
            </div>
        </div>
    </div>
</div>

<!-- Formulário de Lançamento (Oculto) -->
<div id="formularioFinanceiro" class="page-header mb-4" style="display: none;">
    <h2 style="font-size: 1.5rem; margin-bottom: 1.5rem;">Novo Lançamento Financeiro</h2>
    
    <form method="post" action="">
        {% csrf_token %}
        
        <div class="row mb-3">
            <div class="col-md-4">
                <label class="form-label">Tipo</label>
                <select name="tipo" class="form-control" required>
                    <option value="RECEITA">Receita</option>
                    <option value="DESPESA">Despesa</option>
                </select>
            </div>
            
            <div class="col-md-4">
                <label class="form-label">Data</label>
                <input type="date" name="data" class="form-control" required>
            </div>
            
            <div class="col-md-4">
                <label class="form-label">Valor (R$)</label>
                <input type="number" name="valor" class="form-control" step="0.01" min="0" placeholder="0,00" required>
            </div>
        </div>
        
        <div class="row mb-3">
            <div class="col-md-8">
                <label class="form-label">Descrição</label>
                <input type="text" name="descricao" class="form-control" placeholder="Ex: Venda de 30 bois gordos" required>
            </div>
            
            <div class="col-md-4">
                <label class="form-label">Forma de Pagamento</label>
                <select name="forma_pagamento" class="form-control">
                    <option value="PIX">PIX</option>
                    <option value="DINHEIRO">Dinheiro</option>
                    <option value="TRANSFERENCIA">Transferência</option>
                    <option value="CHEQUE">Cheque</option>
                    <option value="BOLETO">Boleto</option>
                </select>
            </div>
        </div>
        
        <div class="d-flex justify-content-end gap-3">
            <button type="button" class="btn-outline" onclick="ocultarFormularioFinanceiro()">
                Cancelar
            </button>
            <button type="submit" class="btn-navy">
                Cadastrar Lançamento
            </button>
        </div>
    </form>
</div>

<!-- Submódulos Financeiros -->
<h2 style="font-family: 'Playfair Display', serif; font-size: 1.75rem; color: var(--navy); margin-bottom: 1.5rem;">
    Módulos Financeiros
</h2>

<div class="cards-grid">
    <div class="card-clean">
        <h3 class="card-title">Fluxo de Caixa</h3>
        <p style="color: var(--text-light); font-size: 14px; margin-bottom: 1rem;">
            Acompanhe entradas e saídas de caixa por período
        </p>
        <button class="btn-outline" style="padding: 0.5rem 1rem; font-size: 13px;" disabled>
            Em Breve
        </button>
    </div>
    
    <div class="card-clean">
        <h3 class="card-title">Contas a Pagar</h3>
        <p style="color: var(--text-light); font-size: 14px; margin-bottom: 1rem;">
            Gerencie despesas programadas e vencimentos
        </p>
        <button class="btn-outline" style="padding: 0.5rem 1rem; font-size: 13px;" disabled>
            Em Breve
        </button>
    </div>
    
    <div class="card-clean">
        <h3 class="card-title">Contas a Receber</h3>
        <p style="color: var(--text-light); font-size: 14px; margin-bottom: 1rem;">
            Controle vendas a prazo e recebimentos futuros
        </p>
        <button class="btn-outline" style="padding: 0.5rem 1rem; font-size: 13px;" disabled>
            Em Breve
        </button>
    </div>
    
    <div class="card-clean">
        <h3 class="card-title">Contas Bancárias</h3>
        <p style="color: var(--text-light); font-size: 14px; margin-bottom: 1rem;">
            Gestão de contas bancárias e saldos
        </p>
        <button class="btn-outline" style="padding: 0.5rem 1rem; font-size: 13px;" disabled>
            Em Breve
        </button>
    </div>
    
    <div class="card-clean">
        <h3 class="card-title">Lançamento Rápido</h3>
        <p style="color: var(--text-light); font-size: 14px; margin-bottom: 1rem;">
            Registre receitas e despesas de forma simplificada
        </p>
        <button class="btn-navy" style="padding: 0.5rem 1rem; font-size: 13px;">
            Novo Lançamento
        </button>
    </div>
    
    <div class="card-clean">
        <h3 class="card-title">Relatórios Financeiros</h3>
        <p style="color: var(--text-light); font-size: 14px; margin-bottom: 1rem;">
            DRE, Balanço, Fluxo de Caixa em PDF
        </p>
        <button class="btn-navy" style="padding: 0.5rem 1rem; font-size: 13px;">
            Gerar Relatório
        </button>
    </div>
</div>

<!-- Últimos Lançamentos -->
<div class="page-header mt-4">
    <h2 style="font-size: 1.5rem; margin-bottom: 1.5rem;">Últimos Lançamentos</h2>
    
    {% if lancamentos %}
    <div class="table-clean">
        <table class="table mb-0">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Descrição</th>
                    <th>Categoria</th>
                    <th>Tipo</th>
                    <th class="text-end">Valor</th>
                </tr>
            </thead>
            <tbody>
                {% for lancamento in lancamentos %}
                <tr>
                    <td>{{ lancamento.data|date:"d/m/Y" }}</td>
                    <td><strong>{{ lancamento.descricao }}</strong></td>
                    <td>{{ lancamento.categoria.nome }}</td>
                    <td>
                        <span class="badge-destaque">{{ lancamento.categoria.get_tipo_display }}</span>
                    </td>
                    <td class="text-end destaque-valor">R$ {{ lancamento.valor }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="card-empty">
        <h4 style="color: var(--text-light); font-weight: 400;">Nenhum lançamento financeiro</h4>
        <p style="color: var(--text-light); margin-bottom: 2rem;">Comece adicionando receitas e despesas</p>
        <button type="button" class="btn-navy" onclick="mostrarFormularioFinanceiro()">Adicionar Primeiro Lançamento</button>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
function mostrarFormularioFinanceiro() {
    document.getElementById('formularioFinanceiro').style.display = 'block';
    document.getElementById('formularioFinanceiro').scrollIntoView({ behavior: 'smooth' });
}

function ocultarFormularioFinanceiro() {
    document.getElementById('formularioFinanceiro').style.display = 'none';
}
</script>
{% endblock %}

