========================================
üîç COMANDOS PARA VERIFICAR ERROS NO DEPLOY
========================================

========================================
1. VER LOGS DO CLOUD RUN
========================================

# Ver √∫ltimos 50 logs
gcloud run services logs read monpec --region=us-central1 --limit=50

# Ver logs em tempo real
gcloud run services logs tail monpec --region=us-central1

# Ver apenas erros
gcloud run services logs read monpec --region=us-central1 --limit=100 | grep -i error

========================================
2. VERIFICAR CONFIGURA√á√ÉO DO SERVI√áO
========================================

# Ver todas as vari√°veis de ambiente
gcloud run services describe monpec --region=us-central1 --format="value(spec.template.spec.containers[0].env)"

# Ver configura√ß√£o completa
gcloud run services describe monpec --region=us-central1

# Verificar se Cloud SQL est√° conectado
gcloud run services describe monpec --region=us-central1 --format="value(spec.template.spec.containers[0].cloudSqlInstances)"

========================================
3. VERIFICAR STATUS DO SERVI√áO
========================================

# Ver status geral
gcloud run services describe monpec --region=us-central1 --format="value(status.conditions)"

# Ver URL do servi√ßo
gcloud run services describe monpec --region=us-central1 --format="value(status.url)"

# Ver √∫ltima revis√£o
gcloud run revisions list --service=monpec --region=us-central1

========================================
4. TESTAR CONEX√ÉO COM O BANCO
========================================

# Verificar se o banco existe
gcloud sql databases list --instance=monpec-db

# Verificar usu√°rios
gcloud sql users list --instance=monpec-db

# Verificar inst√¢ncia Cloud SQL
gcloud sql instances describe monpec-db

========================================
5. VERIFICAR BUILD/IMAGEM
========================================

# Ver logs do Cloud Build (se usado)
gcloud builds list --limit=5

# Ver detalhes do √∫ltimo build
gcloud builds list --limit=1 --format="value(id)" | xargs gcloud builds describe

========================================
6. VERIFICAR PERMISS√ïES
========================================

# Ver IAM do Cloud Run
gcloud run services get-iam-policy monpec --region=us-central1

# Ver service account usado
gcloud run services describe monpec --region=us-central1 --format="value(spec.template.spec.serviceAccountName)"

========================================
7. TESTAR ACESSO AO SERVI√áO
========================================

# Obter URL
SERVICE_URL=$(gcloud run services describe monpec --region=us-central1 --format="value(status.url)")

# Testar acesso
curl -I $SERVICE_URL

# Ver resposta completa
curl $SERVICE_URL

========================================
ERROS COMUNS E SOLU√á√ïES
========================================

ERRO: "CLOUD_SQL_CONNECTION_NAME n√£o definido"
‚Üí Verificar vari√°veis de ambiente
‚Üí Solu√ß√£o: Atualizar com --set-env-vars

ERRO: "Connection refused" ou "could not connect"
‚Üí Verificar se Cloud SQL est√° conectado ao Cloud Run
‚Üí Solu√ß√£o: Adicionar conex√£o no console ou via --add-cloudsql-instances

ERRO: "authentication failed" ou "password authentication failed"
‚Üí Verificar usu√°rio e senha
‚Üí Solu√ß√£o: Usar postgres como usu√°rio (n√£o monpec)

ERRO: "database does not exist"
‚Üí Verificar se banco sistema_rural existe
‚Üí Solu√ß√£o: Criar banco: gcloud sql databases create sistema_rural --instance=monpec-db

ERRO: "Module not found" ou "ImportError"
‚Üí Verificar requirements_producao.txt
‚Üí Solu√ß√£o: Verificar logs do build

ERRO: "Static files not found"
‚Üí Verificar se collectstatic executou
‚Üí Solu√ß√£o: Verificar logs do entrypoint.sh

ERRO: "Migration failed"
‚Üí Verificar logs detalhados
‚Üí Solu√ß√£o: Executar migra√ß√µes manualmente se necess√°rio

========================================
COMANDO R√ÅPIDO PARA DIAGN√ìSTICO COMPLETO
========================================

Execute tudo de uma vez:

echo "=== STATUS DO SERVI√áO ==="
gcloud run services describe monpec --region=us-central1 --format="value(status.conditions)"

echo ""
echo "=== VARI√ÅVEIS DE AMBIENTE ==="
gcloud run services describe monpec --region=us-central1 --format="value(spec.template.spec.containers[0].env)"

echo ""
echo "=== CLOUD SQL CONECTADO ==="
gcloud run services describe monpec --region=us-central1 --format="value(spec.template.spec.containers[0].cloudSqlInstances)"

echo ""
echo "=== √öLTIMOS LOGS (50 linhas) ==="
gcloud run services logs read monpec --region=us-central1 --limit=50

echo ""
echo "=== URL DO SERVI√áO ==="
gcloud run services describe monpec --region=us-central1 --format="value(status.url)"

========================================







